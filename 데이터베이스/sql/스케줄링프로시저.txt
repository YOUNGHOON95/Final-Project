-- 프로시저 호스트 승인 / 거절 하지 않을 경우 거절했다고 간주 스케줄링
CREATE OR REPLACE PROCEDURE UPDATE_BOOKING_STATUS 
IS 
BEGIN 
	UPDATE BOOKING SET STATUS = 3 WHERE (RESERVATION_REQ_DATE +3) = SYSDATE;
END;

DECLARE NO NUMBER;
BEGIN
DBMS_JOB.SUBMIT(:NO , 'UPDATE_BOOKING_STATUS' , SYSDATE , 'TRUNC(SYSDATE)+1+(0/24)' , TRUE);
END;

--호스트 말고 회원 기준에 현재 날짜가 예약 체크아웃 날짜 보다 지나면  STATUS를 5번으로 바꿈
--예약 상태 업데이트 쿼리 저장하는 프로시져
CREATE OR REPLACE PROCEDURE UPDATE_STATUS
	IS 
		BEGIN
			UPDATE BOOKING SET STATUS = 5 WHERE SYSDATE > CHECK_OUT;
		END;
--매일 예약 상태를 업데이트 해주는 스케줄러
DECLARE jobno NUMBER;
BEGIN
DBMS_JOB.SUBMIT(:JOBNO ,'UPDATE_STATUS;', sysdate , 'TRUNC(sysdate)+1+(0/24)' ,true);
END;

--유저권한부여트리거
create or replace TRIGGER roll_make
 AFTER INSERT ON MEMBER
 FOR EACH ROW
 BEGIN
	 
	 INSERT INTO USER_ROLE (ROLE_NAME ,TAGNUMBER , PHONE_NUMBER)
	 VALUES('ROLE_USER' , :NEW.TAGNUMBER , :NEW.PHONE_NUMBER);
 END;